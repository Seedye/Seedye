<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >


      

<mapper namespace="adminMapper">

<!-- 게시글 숫자 조회 -->
<select id = "getListCount" parameterMap="_int" resultType="_int">
	SELECT COUNT(*) FROM BOARD
	WHERE BOARD_CODE = #{boardCode}
	AND BOARD_DEL_FL = 'N'
</select>

<!-- 특정 게시판 목록 조회 -->
<select id="selectBoardList" parameterType="_int" resultMap="board_rm">
SELECT BOARD_NO, BOARD_TITLE, MEMBER_ID, READ_COUNT,CREATE_DATE
		<![CDATA[
		CASE
	WHEN SYSDATE - CREATE_DATE < 1/24/60
	THEN FLOOR((SYSDATE - CREATE_DATE) * 24 * 60 * 60) || '초 전'
	WHEN SYSDATE - CREATE_DATE < 1/24
	THEN FLOOR((SYSDATE - CREATE_DATE) * 24 * 60) || '분 전'
	WHEN SYSDATE - CREATE_DATE < 1
	THEN FLOOR((SYSDATE - CREATE_DATE) * 24) || '시간 전'
	ELSE TO_CHAR(CREATE_DATE, 'YYYY-MM-DD')
		END CREATE_DATE, ]]>
		(SELECT COUNT(*) FROM "COMMENT" C
		WHERE BOARD_NO = B.BOARD_NO
		AND COMMENT_DEL_FL = 'N') COMMENT_COUNT
		FROM BOARD B
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CODE = #{boardCode}
		AND BOARD_DEL_FL = 'N'
		ORDER BY BOARD_NO DESC
</select>

<!-- 검색 조건 일치글 목록 조회 -->

<select id="selectBoardList_search" parameterType="_int" resultMap="board_rm">
	 SELECT BOARD_NO, BOARD_TITLE, MEMBER_ID, READ_COUNT, CREATE_DATE
       		<![CDATA[
		CASE
	WHEN SYSDATE - CREATE_DATE < 1/24/60
	THEN FLOOR((SYSDATE - CREATE_DATE) * 24 * 60 * 60) || '초 전'
	WHEN SYSDATE - CREATE_DATE < 1/24
	THEN FLOOR((SYSDATE - CREATE_DATE) * 24 * 60) || '분 전'
	WHEN SYSDATE - CREATE_DATE < 1
	THEN FLOOR((SYSDATE - CREATE_DATE) * 24) || '시간 전'
	ELSE TO_CHAR(CREATE_DATE, 'YYYY-MM-DD')
		END CREATE_DATE, ]]>
		(SELECT COUNT(*) FROM "COMMENT" C
		WHERE BOARD_NO = B.BOARD_NO
		AND COMMENT_DEL_FL = 'N') COMMENT_COUNT
		FROM BOARD B
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CODE = #{boardCode}
		AND BOARD_DEL_FL = 'N'
          <if test='query != null and query != ""'>
		         <choose>
		            <when test='key == "t"'> <!-- 제목 -->
		               AND BOARD_TITLE LIKE '%${query}%' <!-- #이 아니라 $ 사용해야지 홑따옴표가 안붙고 사용 -->
		            </when>
		            
		            <when test='key == "c"'> <!-- 내용 -->
		               AND BOARD_CONTENT LIKE '%${query}%' 
		            </when>           
		            <when test='key == "tc"'> <!-- 제목+내용 -->
		               AND (BOARD_CONTENT LIKE '%${query}%' OR
		               BOARD_TITLE LIKE '%${query}%')
		            </when>
		         <otherwise> <!-- 작성자(w) -->
		            AND MEMBER_ID LIKE '%${query}%'
		         </otherwise>
		         </choose>
      	  </if>
         
         ORDER BY BOARD_NO DESC
  </select>

</mapper>
